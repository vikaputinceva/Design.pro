{% extends 'basic.html' %}

<title>{% block title %}Личный профиль{% endblock %}</title>

{% block content %}
<div class="container">
    <h2>Добро пожаловать,{{ user.first_name }}</h2>
    <p>Имя: {{ user.first_name }}</p>
    <p>Фамилия: {{ user.last_name }}</p>
    <p>Адрес электронной почты: {{ user.email }}</p>
    <h2>Мои заявки</h2>

    <form method="get" class="mb-4 d-flex align-items-center gap-2">
        <label for="status" class="form-label">Фильтр</label>
        <select class="form-select" name="status" id="status" >
            <option value="">Все</option>
            {% for status_code, status_name in status_choices %}
                <option value="{{ status_code }}" {% if status_code == status_filter %}selected{% endif %}>
                    {{ status_name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-success">Фильтровать</button>
    </form>

    <div>
        {% for application in applications %}
            <div class="py-3">
                <div class="d-flex align-items-center gap-2">
                    <img style="height: 150px; max-width: 150px; object-fit: cover;" src="{{ application.image.url }}" alt="Фото проекта">
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <p class="d-flex align-items-center gap-1">{{ application.title }} {% if application.status == "N" %}
                                    <span class="text-light bg-warning px-2 py-1 rounded-2">Новая</span>
                                {% elif application.status == "P" %}
                                    <span class="text-light bg-info px-2 py-1 rounded-2">Принято в работу</span>
                                {% elif application.status == "D" %}
                                     <span class="text-light bg-success px-2 py-1 rounded-2">Выполнено</span>
                                {% endif %}</p>
                            <span>Категория: {{ application.category }}</span>
                        </div>
                        <div class="d-flex justify-content-end">

                            <p>Дата создания: {{ application.date|date:"d.m.Y H:i" }}</p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="width: 500px; height: 50px; text-overflow: ellipsis; overflow: hidden;">{{ application.description }}</p>
                            <form action="{% url 'application-delete' application.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success">Удалить заявку</button>
                            </form>
                             {% if application.status == 'N' %}
                                <form action="{% url 'application-delete' application.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success">Удалить заявку</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div>
                <p>У вас нет заявок</p>
            </div>
        {% endfor %}
    </div>
</div>


{% endblock %}