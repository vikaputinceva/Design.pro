{% extends 'basic.html' %}
{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî Design.Pro{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1 class="page-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Design.Pro</h1>
        <p class="admin-welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name }}! –í—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.</p>
    </div>

    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert-message {{ message.tags }}">
            {{ message }}
            <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="stats-box">
        <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ stats.total }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.new }}</div>
                <div class="stat-label">–ù–æ–≤—ã–µ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.in_work }}</div>
                <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.completed }}</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
        </div>
    </div>

    <div class="admin-section">
        <div class="section-header">
            <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏</h2>
        </div>

        {% if recent_apps %}
        <div class="admin-table-container">
            <div class="admin-table-header">
                <h2>–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h2>
                <div class="admin-table-controls">
                    <input type="text" class="admin-search" placeholder="–ü–æ–∏—Å–∫...">
                    <select class="admin-filter">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="N">–ù–æ–≤—ã–µ</option>
                        <option value="P">–í —Ä–∞–±–æ—Ç–µ</option>
                        <option value="D">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in recent_apps %}
                        <tr>
                            <td>#{{ app.id }}</td>
                            <td>{{ app.title|truncatechars:30 }}</td>
                            <td>{{ app.applicant.username }}</td>
                            <td>
                                {% if app.status == 'N' %}
                                    <span class="admin-status-badge admin-status-new">–ù–æ–≤–∞—è</span>
                                {% elif app.status == 'P' %}
                                    <span class="admin-status-badge admin-status-work">–í —Ä–∞–±–æ—Ç–µ</span>
                                {% else %}
                                    <span class="admin-status-badge admin-status-done">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td>{{ app.date|date:"d.m.Y" }}</td>
                            <td>
                                <form method="post" action="{% url 'admin_change_status' app.id %}" class="status-form">
                                    {% csrf_token %}
                                    <select name="status" class="form-select">
                                        <option value="N" {% if app.status == 'N' %}selected{% endif %}>–ù–æ–≤–∞—è</option>
                                        <option value="P" {% if app.status == 'P' %}selected{% endif %}>–ü—Ä–∏–Ω—è—Ç–æ –≤ —Ä–∞–±–æ—Ç—É</option>
                                        <option value="D" {% if app.status == 'D' %}selected{% endif %}>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                                    </select>

                                    <div class="form-fields">
                                        {% if app.status == 'P' or app.status == 'D' %}
                                        <div class="form-group">
                                            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                                            <textarea name="comment" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
                                                      class="form-textarea">{{ app.comment|default:'' }}</textarea>
                                        </div>
                                        {% endif %}

                                        {% if app.status == 'D' %}
                                        <div class="form-group">
                                            <label class="form-label">–§–æ—Ç–æ –¥–∏–∑–∞–π–Ω–∞:</label>
                                            <input type="file" name="design_image" class="form-file">
                                        </div>
                                        {% endif %}
                                    </div>

                                    <button type="submit" class="admin-btn admin-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </form>

                                {% if app.status == 'N' %}
                                <form method="post" action="{% url 'application-delete' app.id %}"
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É?')" class="delete-form">
                                    {% csrf_token %}
                                    <button type="submit" class="admin-btn admin-btn-danger">–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                                </form>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <div class="admin-empty-state">
            <div class="admin-empty-icon">üì≠</div>
            <h3 class="admin-empty-title">–ù–µ—Ç –∑–∞—è–≤–æ–∫</h3>
            <p class="admin-empty-text">–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ</p>
        </div>
        {% endif %}
    </div>

    <div class="admin-section">
        <div class="section-header">
            <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h2>
        </div>

        <div class="admin-form">
            <form method="post" action="{% url 'admin_add_category' %}" class="category-form">
                {% csrf_token %}
                <div class="admin-form-group">
                    <label for="category-name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                    <div class="input-group">
                        <input type="text" name="name" id="category-name"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" required class="admin-form-control">
                        <button type="submit" class="admin-btn admin-btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </form>

            {% if categories %}
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category in categories %}
                        <tr>
                            <td>{{ category.name }}</td>
                            <td>
                                <form method="post" action="{% url 'admin_delete_category' %}"
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –í—Å–µ –∑–∞—è–≤–∫–∏ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')">
                                    {% csrf_token %}
                                    <input type="hidden" name="category_id" value="{{ category.id }}">
                                    <button type="submit" class="admin-btn admin-btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="admin-warning">
                <p>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}