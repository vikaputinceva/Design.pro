{% extends 'basic.html' %}
{% load static %}

{% block title %}Главная - Design.Pro{% endblock %}

{% block content %}
<div class="main-content">
    <h1 class="page-title">Design.Pro - Платформа дизайнерских проектов</h1>

    {% if user.is_authenticated and not user.is_staff %}
        <div class="create-prompt">
            <p class="prompt-text">Есть идея для дизайнерского проекта?</p>
            <a class="create-button" href="{% url 'application-create' %}">
                <i class="bi bi-plus-circle me-2"></i>Создать заявку
            </a>
        </div>

        <div class="stats-display">
            <i class="bi bi-graph-up"></i>
            Заявок в работе: <strong>{{ in_progress }}</strong>
        </div>

        {% if completed_applications %}
            {% for application in completed_applications %}
                <div class="application-item">
                    <div class="app-header">
                        <div class="app-title-section">
                            <h3 class="app-title">{{ application.title }}</h3>
                            {% if application.status == "N" %}
                                <span class="status-badge status-new">Новая</span>
                            {% elif application.status == "P" %}
                                <span class="status-badge status-progress">В работе</span>
                            {% elif application.status == "D" %}
                                <span class="status-badge status-completed">Выполнено</span>
                            {% endif %}
                        </div>
                        <div class="category-info">
                            <i class="bi bi-tag"></i>
                            Категория: {{ application.category|default:"Без категории" }}
                        </div>
                    </div>

                    <div class="app-body">
                        <div class="app-image-container">
                            {% if application.image %}
                                <img class="app-image" src="{{ application.image.url }}" alt="{{ application.title }}">
                            {% else %}
                                <div class="image-placeholder">
                                    <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
                                </div>
                            {% endif %}
                        </div>

                        <div class="app-details">
                            <div class="app-description-section">
                                <p style="width: 100%; height: 60px; text-overflow: ellipsis; overflow: hidden; margin-bottom: 20px;">
                                    {{ application.description }}
                                </p>
                            </div>

                            <div class="app-meta-info">
                                <div class="app-info-row">
                                    <div class="info-item">
                                        <i class="bi bi-calendar"></i>
                                        <span>Дата создания: {{ application.date|date:"d.m.Y H:i" }}</span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-person-circle"></i>
                                        <span>Создатель: {{ application.applicant.username }}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="app-actions d-flex justify-content-end mt-3">
                                <a class="btn btn-success" href="{% url 'application-detail' application.pk %}">
                                    <i class="bi bi-info-circle me-2"></i>Подробнее о заявке
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                {% if not forloop.last %}
                    <hr class="app-divider">
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="role-card" style="background: #f8f9fa; padding: 40px; text-align: center;">
                <div class="role-icon">
                    <i class="bi bi-folder-plus" style="color: #6c757d; font-size: 3rem;"></i>
                </div>
                <h3 class="role-title">Нет выполненных заявок</h3>
                <p class="role-description">Создайте свою первую заявку</p>
                <a href="{% url 'application-create' %}" class="create-button">
                    <i class="bi bi-plus-circle me-2"></i>Создать заявку
                </a>
            </div>
        {% endif %}

    {% else %}
        <div class="roles-container">
            <div class="role-card">
                <div class="role-icon" style="color: #0d6efd;">
                    <i class="bi bi-briefcase"></i>
                </div>
                <h3 class="role-title">Заказчикам</h3>
                <p class="role-description">Размещайте заявки на дизайнерские услуги и находите лучших исполнителей</p>
                <a href="{% url 'register' %}" class="btn btn-primary">
                    <i class="bi bi-person-plus me-2"></i>Начать работу
                </a>
            </div>

            <div class="role-card">
                <div class="role-icon" style="color: #198754;">
                    <i class="bi bi-palette"></i>
                </div>
                <h3 class="role-title">Дизайнерам</h3>
                <p class="role-description">Находите интересные проекты, развивайте портфолио и зарабатывайте</p>
                <a href="{% url 'register' %}" class="btn btn-success">
                    <i class="bi bi-arrow-right-circle me-2"></i>Присоединиться
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}